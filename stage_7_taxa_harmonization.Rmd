---
title: "stage_7_taxa_harmonization"
author: "Shahar Chaikin"
date: "2025-10-01"
output: html_document
---
Harmonize the species list from the log_biomass_medits data

libraries
```{r}
library(tidyverse)
```

Data
```{r}
species=read_rds("annual_biomass_ratio_medits.rds") %>% 
  select(species) %>% distinct()
```

taxa harmonization
```{r}
#Harmonization of scientific names by correcting spelling errors and converting nomenclatural synonyms to currently accepted names
Harmonization=bdc::bdc_query_names_taxadb(
  unique(species$species),
  suggest_names = T)


Harmonization$notes %>% unique
#"accepted" (valid accepted name)
#"wasMisspelled" (original name was misspelled)
#"replaceSynonym" (a synonym replaced by an accepted name)
#"notFound" (no matching name found)
#heterotypic synonym", "homotypic synonym", and "pro-parte synonym". Ambiguous synonyms, names that have been published more than once describing different species, have more than one accepted name and cannot be resolved. Such cases are flagged and left to be determined by the user
```

Dealing with unaccepted names
 
- Trigloporus lastoviza  should be replaced with Chelidonichthys lastoviza

```{r}
Harmonization_fix=Harmonization %>% 
  mutate(
    scientificName=case_when(
      original_search%in%"Trigloporus lastoviza"~"Chelidonichthys lastoviza",
      TRUE~scientificName)) %>% 
  select(species=original_search,
         corrected=scientificName) %>% 
  mutate(is_cahnged=species==corrected)
#write.csv(Harmonization_fix,"harmonization_bdc_fix_MEDITS.csv",row.names = F)
```